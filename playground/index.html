<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ENG Playground</title>

<!-- Prism theme -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />

<style>
:root {
  --bg: #1e1e1e;
  --panel-bg: #1e1e1e;
  --border: #3c3c3c;
  --text: #d4d4d4;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  --code-size: 16px;
  --pane-h: 420px;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: var(--mono);
}

h1 {
  text-align: center;
  padding: 14px 0 6px;
  margin: 0;
  font-weight: 600;
}

.toolbar, .zoom-control {
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 10px;
}

button {
  cursor: pointer;
  background: #2d2d2d;
  color: var(--text);
  border: 1px solid var(--border);
  padding: 6px 12px;
  border-radius: 6px;
  font-family: var(--mono);
  transition: background .15s ease, border-color .15s ease;
}
button:hover { background: #3c3c3c; }

.container {
  display: flex;
  gap: 20px;
  padding: 12px;
  width: 100%;
  max-width: 100%;
}

.pane {
  flex: 1;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: var(--panel-bg);
  height: var(--pane-h);
  overflow: auto;
  font-family: var(--mono);
  font-size: var(--code-size);
  line-height: 1.5;
  color: var(--text);
  position: relative;
}

#editorWrapper {
  padding: 0;
  position: relative;
}

#editorInput {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: transparent;
  color: transparent;
  caret-color: white;
  border: none;
  resize: none;
  outline: none;
  font-family: var(--mono);
  font-size: var(--code-size);
  line-height: 1.5;
  padding: 10px;
  overflow: auto;
  z-index: 2;
  white-space: pre;
}

#editorHighlight {
  position: absolute;
  top: 0; left: 0;
  padding: 10px;
  pointer-events: none;
  white-space: pre-wrap;
  word-wrap: break-word;
  z-index: 1;
}

#output {
  margin: 0;
  padding: 10px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Autocomplete dropdown */
#autocomplete {
  position: absolute;
  background: #2d2d2d;
  border: 1px solid var(--border);
  border-radius: 6px;
  max-height: 220px;
  overflow-y: auto;
  display: none;
  z-index: 5;
  font-size: var(--code-size);
  width: 220px;
}

#autocomplete div {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  cursor: pointer;
}
#autocomplete div:hover, 
#autocomplete .selected {
  background: #444;
}

/* Icons */
.symbol {
  width: 18px;
  text-align: center;
  opacity: 0.8;
}
.symbol.keyword { color: #569cd6; }  /* blue */
.symbol.variable { color: #9cdcfe; } /* light blue */
.symbol.class { color: #4ec9b0; }    /* teal */
.symbol.method { color: #dcdcaa; }   /* yellow */
</style>
</head>
<body>

<h1>ENG Playground</h1>

<div class="toolbar">
  <button id="runButton">Run</button>
  <button id="clearButton">Clear</button>
  <button id="copyOutput">Copy Output</button>
</div>

<div class="zoom-control">
  <button id="zoomOut">A-</button>
  <span id="fontSizeDisplay">16px</span>
  <button id="zoomIn">A+</button>
</div>

<div class="container">
  <!-- Editor -->
  <div id="editorWrapper" class="pane">
    <textarea id="editorInput" spellcheck="false"></textarea>
    <pre><code id="editorHighlight" class="language-eng"></code></pre>
    <div id="autocomplete"></div>
  </div>

  <!-- Output -->
  <div id="outputWrapper" class="pane">
    <pre id="output"></pre>
  </div>
</div>

<footer>ENG Playground © 2025</footer>

<!-- Prism -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script>
Prism.languages.eng = {
  'comment': /#.*$/m,
  'string': /(["'])(?:(?=(\\?))\2.)*?\1/,
  'keyword': /\b(?:let|set|say|input|repeat|while|break|continue|function|class|return|true|false)\b/,
  'number': /\b\d+(?:\.\d+)?\b/,
  'operator': /[+\-*\/=]/,
  'punctuation': /[()[\]{}:,]/
};

const editorInput = document.getElementById('editorInput');
const editorHighlight = document.getElementById('editorHighlight');
const output = document.getElementById('output');
const fontSizeDisplay = document.getElementById('fontSizeDisplay');
const autocomplete = document.getElementById('autocomplete');

let codeSize = 16;

function applyFontSize() {
  document.documentElement.style.setProperty('--code-size', codeSize + 'px');
  fontSizeDisplay.textContent = codeSize + 'px';
}

document.getElementById('zoomIn').addEventListener('click', () => {
  codeSize = Math.min(50, codeSize + 2);
  applyFontSize();
});
document.getElementById('zoomOut').addEventListener('click', () => {
  codeSize = Math.max(10, codeSize - 2);
  applyFontSize();
});
document.getElementById('copyOutput').addEventListener('click', () => {
  navigator.clipboard.writeText(output.innerText || '');
});

// Live syntax highlight
function updateHighlight() {
  editorHighlight.textContent = editorInput.value;
  Prism.highlightElement(editorHighlight);
}
editorInput.addEventListener('input', () => {
  updateHighlight();
  updateAutocomplete();
});

// Initial text
editorInput.value = `# Welcome to ENG programming
say "Hello, World!"
let x = 10
class Demo {
  function greet() {
    say "Hi!"
  }
}`;
updateHighlight();
applyFontSize();

/* === Autocomplete System === */
const keywords = [
  "break", "class", "continue", "false", "function", "input", 
  "let", "repeat", "return", "say", "set", "true", "while"
];

let variables = new Set();
let classes = new Set();
let methods = new Set();

function updateAutocomplete() {
  const text = editorInput.value;
  const cursorPos = editorInput.selectionStart;
  const prefix = getCurrentWord(text, cursorPos);

  // Extract variables and classes
  variables = new Set((text.match(/\blet\s+(\w+)/g) || []).map(m => m.split(" ")[1]));
  classes = new Set((text.match(/\bclass\s+(\w+)/g) || []).map(m => m.split(" ")[1]));
  methods = new Set((text.match(/\bfunction\s+(\w+)/g) || []).map(m => m.split(" ")[1]));

  let suggestions = [];

  keywords.forEach(k => suggestions.push({ type: "keyword", word: k }));
  variables.forEach(v => suggestions.push({ type: "variable", word: v }));
  classes.forEach(c => suggestions.push({ type: "class", word: c }));
  methods.forEach(m => suggestions.push({ type: "method", word: m }));

  suggestions = suggestions
    .filter(s => s.word.startsWith(prefix))
    .sort((a, b) => a.word.localeCompare(b.word));

  if (prefix && suggestions.length > 0) {
    autocomplete.innerHTML = "";
    suggestions.forEach(s => {
      const div = document.createElement("div");
      const icon = document.createElement("span");
      icon.className = "symbol " + s.type;
      icon.textContent = {
        keyword: "📘",
        variable: "🔤",
        class: "🏛️",
        method: "⚙️"
      }[s.type];
      const textNode = document.createElement("span");
      textNode.textContent = s.word;
      div.appendChild(icon);
      div.appendChild(textNode);

      div.onclick = () => insertAutocomplete(s.word, cursorPos, prefix);
      autocomplete.appendChild(div);
    });
    autocomplete.style.display = "block";
    autocomplete.style.left = "10px";
    autocomplete.style.top = "40px";
  } else {
    autocomplete.style.display = "none";
  }
}

function getCurrentWord(text, pos) {
  let start = pos;
  while (start > 0 && /\w/.test(text[start - 1])) start--;
  return text.slice(start, pos);
}

function insertAutocomplete(word, cursorPos, prefix) {
  const text = editorInput.value;
  const start = cursorPos - prefix.length;
  const newText = text.slice(0, start) + word + text.slice(cursorPos);
  editorInput.value = newText;
  editorInput.selectionStart = editorInput.selectionEnd = start + word.length;
  updateHighlight();
  autocomplete.style.display = "none";
}
</script>

<script src="interpreter.js"></script>
</body>
</html>
